---
import { trpcClient } from "@frontend/src/utils/trpc-server";
import { ManufacturersWhereInputSchema } from "@backend/lib/zod/index";
import BaseLayout from "@frontend/src/layouts/BaseLayout.astro";
import { z } from "zod";
import ManufacturersListClientProvider from "@frontend/src/components/manufacturers/ManufacturersListClientProvider";
const { slug } = Astro.params;

const manufacturers = await trpcClient.manufacturers.publicList.query({
  where: {
    manufacturers_categories: {
      some: {
        manufacturers_categories_categories: {
          code: {
            equals: slug,
          },
        },
      },
    },
  },
  take: 20,
  imageSizes: [
    {
      image_code: "logo",
      size_code: "300_300",
    },
  ],
});
const category = await trpcClient.categories.publicOne.query({
  where: {
    code: slug,
  },
});

export const prerender = false;
if (!category) return Astro.redirect("/404");
---

<BaseLayout title={category.name} showHeaderFilter={true}>
  <ManufacturersListClientProvider
    initialData={manufacturers}
    categorySlug={slug}
    client:load
  />
</BaseLayout>
